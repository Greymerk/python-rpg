'''
Created on 2013-05-27

@author: brian
'''

from items import Spellbook

class Cast(object):

    def __init__(self, actor):
        
        self.actor = actor
        self.target = None
        self.selectedSpell = None
        
    def condition(self):
        
        if not self.actor.inventory.offhand.__class__ is Spellbook:
            return False
        
        spellList = self.actor.inventory.offhand.spellList
        
        for spell in spellList:
        
            self.target = None


            for e in self.actor.world.getAllEntities():
                if spell.validTarget(self.actor, e):
                    self.selectedSpell = spell
                    self.target = e
                    return True
                
        return False
    
    def do(self):
        
        if self.target is None:
            return
        
        self.actor.cast(self.selectedSpell, self.target.position)
        
